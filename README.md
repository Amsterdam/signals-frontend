
# Signalen

This project is based on the react boilerplate that was adapted for the needs of the municipality of Amsterdam.
See https://github.com/Amsterdam/react-boilerplate.git for more information on the react boilerplate

## Requirements

  -  npm >= 6.11
  -  node 12.18

This project relies on the[ `leaflet-headless`](https://www.npmjs.com/package/leaflet-headless) package. On OSX, you'll need to have [`cairo`](https://formulae.brew.sh/formula/cairo), [`pango`](https://formulae.brew.sh/formula/pango) and [`cmake`](https://formulae.brew.sh/formula/cmake) installed.

## Installation

  -  npm install

## Configuration

Configuration for theming, map and API endpoint URLs is defined in
`environment.conf.json`.

## Development

To overwrite some configuration for development purposes you can define them in
`environment.conf.development.json`. This file is ignored by git.

The SPA will run over HTTP on `localhost` at port `3001`. The port can be configured by setting the environment variable `PORT`.

    npm start

    PORT=8000 npm start

Do note that the application uses an external authentication service that does not accept any port. The whitelisted ports are `3000` and `3001`

### HTTPS

The application's production build uses a [serviceworker](https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API) that is configured through the Webpack Offline plugin (see [webpack config](./internals/webpack/webpack.prod.babel.js)) and is installed in [app.js](./src/app.js).

To run the application with the production code and have the serviceworker available, the site needs to be run over HTTPS. This can be accomplished by running

    HTTPS=true npm run start:prod

## Testing

By default, the unit test generates a coverage report (thresholds are set in [jest.config.js](./jest.config.js)).

Running all tests and generate the coverage report:

    npm test

## Deployment

When deploying the docker container, there are some files you can overwrite for
branding purposes.

- `environment.conf.json` with configuration for theming and endpoint URLs.
- The logo, as defined by `logo.url` in `environment.conf.json`.
- `favicon.png` the favicon, needs to be a PNG.
- `manifest.json` with configuration for the PWA.
- `icon_...x....png` the icons for the PWA in various sizes, need to be PNGs.

The logo displayed on the website is defined by the `logo.url` parameter in
`environment.conf.json`. This can be a remote URL or a local file path. Define
for instance `/logo.svg` and you can inject your own `logo.svg` when starting
the docker container.

The `manifest.json` file for the PWA is generated by webpack, but you can
overwrite it with your own configuration. This file also defines some icons,
which, in turn, can be injected into the container as well.

There is an icon for android of 192 x 192 pixels in size, defined in
`manifest.json`. For iOS there's an icon of 180 x 180 pixels in size, this is
defined directly in `index.html`. All icons have to be PNGs. The icon for iOS
must not contain transparency.

See also
https://stackoverflow.com/questions/2997437/what-size-should-apple-touch-icon-png-be-for-ipad-and-iphone?answertab=votes#tab-top
and
https://developer.apple.com/library/archive/documentation/AppleApplications/Reference/SafariWebContent/ConfiguringWebApplications/ConfiguringWebApplications.html.

An example command for running the container and injecting some files:

    docker run -d -p 8080:80 \¬
      -v /branding/config.json:/environment.conf.json \¬
      -v /branding/logo.png:/usr/share/nginx/html/logo.png \¬
      -v /branding/favicon.png:/usr/share/nginx/html/favicon.png \¬
      -v /branding/android.png:/usr/share/nginx/html/icon_192x192.png \¬
      -v /branding/ios.png:/usr/share/nginx/html/icon_180x180.png \¬
      signalen/frontend¬

## Thanks to
<a href="http://browserstack.com/"><img src="src/images/browserstack-logo-600x315.png" height="130" alt="BrowserStack Logo" /></a>
